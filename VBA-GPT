Sub TriggersRatings()

    Dim derLB, derLR, i, j, lim_actu, lim_old As Integer
    Dim rt_actu, rt_old As Integer
        
    derLB = Sheets("8BankFramework").Cells(Rows.Count, 3).End(xlUp).Row
    derLR = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    
    Call EnleverTrigger
    
    For i = 4 To derLR
        rt_actu = Sheets("6RatingsExternes").Cells(i, 12).Value
        rt_old = Sheets("7ArchiveRatings").Cells(i, 12).Value
        
        If rt_actu <> rt_old Then
            If Sheets("6RatingsExternes").Cells(i, 5).Value <> "-" Then
                If Sheets("6RatingsExternes").Cells(i, 5).Value > 5000000000# Then
                    If rt_actu <> "NR" Then
                        For j = 4 To derLB
                            
                            If rt_actu = Sheets("8BankFramework").Cells(j, 3).Value Then
                                lim_actu = Sheets("8BankFramework").Cells(j, 6).Value
                            End If
                            
                            If rt_old = Sheets("8BankFramework").Cells(j, 3).Value Then
                                lim_old = Sheets("8BankFramework").Cells(j, 6).Value
                            End If
                            
                            'lim_actu < lim_old Trigger dur négatif rouge
                            If lim_actu < lim_old Then
                                Sheets("6RatingsExternes").Cells(i, 12).Interior.ColorIndex = 22
                            ElseIf lim_actu > lim_old Then
                                Sheets("6RatingsExternes").Cells(i, 12).Interior.ColorIndex = 43
                            Else
                                Sheets("6RatingsExternes").Cells(i, 12).Interior.ColorIndex = 43
                            End If
                        Next
                    End If
                ElseIf Sheets("6RatingsExternes").Cells(i, 5).Value < 5000000000# Then
                    If rt_actu <> "NR" Then
                        For j = 4 To derLB
                            
                            If rt_actu = Sheets("8BankFramework").Cells(j, 3).Value Then
                                lim_actu = Sheets("8BankFramework").Cells(j, 6).Value
                            End If
                            
                            If rt_old = Sheets("8BankFramework").Cells(j, 3).Value Then
                                lim_old = Sheets("8BankFramework").Cells(j, 6).Value
                            End If
                            
                            'lim_actu < lim_old Trigger dur négatif rouge
                            If lim_actu < lim_old Then
                                Sheets("6RatingsExternes").Cells(i, 12).Interior.ColorIndex = 22
                            ElseIf lim_actu > lim_old Then
                                Sheets("6RatingsExternes").Cells(i, 12).Interior.ColorIndex = 43
                            Else
                                Sheets("6RatingsExternes").Cells(i, 12).Interior.ColorIndex = 43
                            End If
                        Next
                    End If
                End If
            End If
        End If
    Next
    
End Sub
