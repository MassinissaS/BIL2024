Sub ArchivageOnglet()

    Dim sourceWorkbook As Workbook
    Dim destinationWorkbook As Workbook
    Dim sheetToCopy As Worksheet
    Dim destinationPath As String
    Dim destinationFileName As String
    Dim latest_date_old As Date
    Dim copiedSheet As Worksheet
    Dim fileExists As Boolean
    Dim startPos As Integer
    Dim monthAndYear As String
    Dim monthName_old As String
    Dim yearValue_old As Integer ' Modifier pour un entier
    Dim text As String
    Dim sheetName As String

    ' Obtenir le nom du mois et de l'année
    text = Sheets("1.5Passage").Range("C1").Value
    startPos = InStr(text, "of :") + Len("of :")
    monthAndYear = Trim(Mid(text, startPos))
    monthName_old = Split(monthAndYear)(0)
    yearValue_old = CInt(Split(monthAndYear)(1)) ' Conversion en entier
    
    ' Soustraire 1 à l'année
    yearValue_old = yearValue_old - 1
    
    ' Spécifiez le chemin du répertoire et le nom du fichier de destination
    destinationPath = "H:\Outils\Archives-Banques-Ratings\"
    destinationFileName = "Archives-Banques-Ratings-" & yearValue_old & ".xlsx"
    
    ' Vérifier si le fichier existe
    If Dir(destinationPath & destinationFileName) <> "" Then
        fileExists = True
    Else
        fileExists = False
    End If
    
    ' Ouvrir le classeur de destination ou le créer s'il n'existe pas
    If fileExists Then
        Set destinationWorkbook = Workbooks.Open(destinationPath & destinationFileName)
    Else
        Set destinationWorkbook = Workbooks.Add
        destinationWorkbook.SaveAs Filename:=destinationPath & destinationFileName
    End If

    ' Référencez le classeur source
    Set sourceWorkbook = ThisWorkbook ' Assumant que le code est exécuté à partir du classeur source
    
    ' Fonction pour vérifier et supprimer une feuille si elle existe déjà
    Call DeleteSheetIfExists(destinationWorkbook, "Summary")
    Call DeleteSheetIfExists(destinationWorkbook, "Datas")
    Call DeleteSheetIfExists(destinationWorkbook, "Thresholds")
    
    ' 1. Copier l'onglet "4Summary" et le renommer "Summary"
    sourceWorkbook.Sheets("4Summary").Copy Before:=destinationWorkbook.Sheets(1)
    Set copiedSheet = destinationWorkbook.Sheets(1)
    copiedSheet.Name = "Summary"
    
    ' 2. Copier l'onglet "1.5Passage" et le renommer "Datas"
    sourceWorkbook.Sheets("1.5Passage").Copy After:=destinationWorkbook.Sheets(1)
    Set copiedSheet = destinationWorkbook.Sheets(2)
    copiedSheet.Name = "Datas"
    
    ' 3. Copier l'onglet "3Thresholds" et le renommer "Thresholds"
    sourceWorkbook.Sheets("3Thresholds").Copy After:=destinationWorkbook.Sheets(2)
    Set copiedSheet = destinationWorkbook.Sheets(3)
    copiedSheet.Name = "Thresholds"
    
    ' Sauvegarder et fermer le classeur de destination
    destinationWorkbook.Save
    destinationWorkbook.Close

    ' Message de confirmation - à supprimer après la phase de test
    MsgBox "The data has been archived in " & destinationFileName

End Sub

' Fonction pour supprimer une feuille si elle existe déjà
Sub DeleteSheetIfExists(wb As Workbook, sheetName As String)
    Dim ws As Worksheet
    On Error Resume Next
    Set ws = wb.Sheets(sheetName)
    On Error GoTo 0
    
    If Not ws Is Nothing Then
        Application.DisplayAlerts = False ' Désactiver les alertes pour supprimer la feuille sans confirmation
        ws.Delete
        Application.DisplayAlerts = True ' Réactiver les alertes
    End If
End Sub
