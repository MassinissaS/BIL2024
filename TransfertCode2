Sub SauvegarderVersionModifiee()
    Dim cheminRepertoire As String
    Dim nomFichier As String
    Dim nouvelleCheminComplet As String
    Dim wbCopie As Workbook
    Dim ws As Worksheet
    Dim texteA1 As String
    Dim moisTexte As String
    Dim mois As Integer
    Dim annee As Integer
    Dim trimestre As Integer
    Dim nomFichierAuto As String
    Dim debutParenthese As Integer
    Dim finParenthese As Integer
    Dim contenuParenthese As String

    ' Définir le répertoire de sauvegarde (modifiez ce chemin selon vos besoins)
    cheminRepertoire = "C:\Chemin\De\Votre\Répertoire\"
    
    ' Vérifier si le répertoire existe
    If Dir(cheminRepertoire, vbDirectory) = "" Then
        MsgBox "Le répertoire spécifié n'existe pas.", vbExclamation
        Exit Sub
    End If

    ' Récupérer le texte de la cellule A1 de l'onglet "1Current"
    texteA1 = Sheets("1Current").Range("A1").Value
    
    ' Trouver les positions des parenthèses
    debutParenthese = InStr(texteA1, "(")
    finParenthese = InStr(texteA1, ")")
    
    ' Extraire le contenu entre parenthèses
    contenuParenthese = Mid(texteA1, debutParenthese + 1, finParenthese - debutParenthese - 1)
    
    ' Extraire le mois et l'année à partir du contenu entre parenthèses
    moisTexte = Trim(Split(contenuParenthese)(0))  ' Récupère le mois en texte
    annee = CInt(Trim(Split(contenuParenthese)(1))) ' Récupère l'année
    
    ' Convertir le mois en format numérique
    Select Case moisTexte
        Case "January": mois = 1
        Case "February": mois = 2
        Case "March": mois = 3
        Case "April": mois = 4
        Case "May": mois = 5
        Case "June": mois = 6
        Case "July": mois = 7
        Case "August": mois = 8
        Case "September": mois = 9
        Case "October": mois = 10
        Case "November": mois = 11
        Case "December": mois = 12
        Case Else
            MsgBox "Le mois dans la cellule A1 n'est pas valide.", vbExclamation
            Exit Sub
    End Select
    
    ' Calculer le numéro du trimestre en fonction du mois
    trimestre = Application.WorksheetFunction.RoundUp(mois / 3, 0)

    ' Générer le nom de fichier automatique
    nomFichierAuto = "Archives-Souverains-T" & trimestre & "-" & annee & ".xlsm"
    
    ' Créer le chemin complet avec le nom de fichier généré automatiquement
    nouvelleCheminComplet = cheminRepertoire & nomFichierAuto
    
    ' Si un fichier portant le même nom existe déjà, il est supprimé
    If Dir(nouvelleCheminComplet) <> "" Then
        Kill nouvelleCheminComplet
    End If

    ' Sauvegarder une copie du fichier
    ThisWorkbook.SaveCopyAs nouvelleCheminComplet

    ' Ouvrir la copie du fichier
    Set wbCopie = Workbooks.Open(nouvelleCheminComplet)
    
    ' Supprimer tous les onglets sauf "1Current", "2Thresholds", et "3Summary"
    For Each ws In wbCopie.Worksheets
        If ws.Name <> "1Current" And ws.Name <> "2Thresholds" And ws.Name <> "3Summary" Then
            Application.DisplayAlerts = False
            ws.Delete
            Application.DisplayAlerts = True
        End If
    Next ws

    ' Renommer les onglets
    wbCopie.Sheets("1Current").Name = "Current"
    wbCopie.Sheets("2Thresholds").Name = "Thresholds"
    wbCopie.Sheets("3Summary").Name = "Summary"

    ' Réorganiser les onglets pour que "Summary" soit en première position
    wbCopie.Sheets("Summary").Move Before:=wbCopie.Sheets(1)

    ' Sauvegarder et fermer le fichier
    wbCopie.Close SaveChanges:=True

    ' Avertir l'utilisateur
    MsgBox "La version modifiée a été sauvegardée avec succès dans " & nouvelleCheminComplet, vbInformation
End Sub
